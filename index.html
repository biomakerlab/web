<!DOCTYPE html>
<html>
	<head> 		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
 		<script type="text/javascript">
	        var ws;
	        var wsUri = "ws://192.168.128.13:1880/ws/MicrobialDesignStudio"; // for modem? 
	        var loc = window.location;
	        
	        var topicName = "@spec";

	        var syringeProxyPrefix = '@i2cSerialProxy' ;  
	        var electroporatorPrefix = '@electroporator';
	        var purifierPrefix = '@purifier'; 

	        var wheelPrefix = '@wheel';
	        var pumpPrefix = '@mediapump';
	        var carouselPrefix = '@carousel';
	        var heaterPrefix = '@heater';
	        var specPrefix = '@spec';
	        var tempPrefix = '@temp'; 

	        var incubatorPrefix = '@incubator' ;

	        // keep track of number of cycles 
	        var cycleCount = 0; 

	        console.log(loc);

	        // call to connect web socket
	        // wsConnect(); 

	        function wsConnect() {
	            console.log("connect",wsUri);
	            ws = new WebSocket(wsUri);
	            //var line = "";    // either uncomment this for a building list of messages
	            /*
	            ws.onmessage = function(msg) {
	                var line = "";  // or uncomment this to overwrite the existing message
	                // parse the incoming message as a JSON object
	                var data = msg.data;
	                //console.log(data);
	                // build the output from the topic and payload parts of the object
	                line += "<p>"+data+"</p>";
	                // replace the messages div with the new "line"
	                document.getElementById('messages').innerHTML = line;
	                //ws.send(JSON.stringify({data:data}));
	            }
	            */
	            ws.onmessage = function(msg) {
	            	// parsing messages 
	                var data = msg.data;
	                data = data.substr(1); 

	                if (data.includes("carouselProcessing")) {
		                data = data.replace(": ", "_");
		                data = data.replace(" ", "(");
		                data = data.replace("\r", ") //"); //final: carouselProcessing_SPIN(-100) //-100
		                eval(data); // dangerous but effective 
	                } else if (data.includes("bmlcycle")) {
	                	data = data.replace("=", "(");
	                	data = data + ")";
						eval(data); 
	                }	                                        
	            }
	            ws.onopen = function() {
	                // update the status div with the connection status
	                document.getElementById('status').innerHTML = 'Connected to ' + '<b>'+ wsUri+'</b>';
	                //ws.send("Open for data");
	                console.log("connected");
	            }
	            ws.onclose = function() {
	                // update the status div with the connection status
	                document.getElementById('status').innerHTML = "not connected";
	                // in case of lost connection tries to reconnect every 3 secs
	                setTimeout(wsConnect,3000);
	            }
	        }

	        /////////////////// Data Processing //////////////////////
	        function carouselProcessing_SPIN(steps){
	        	console.log("carousel processing function called");
	        	var rotation = steps / 1400.0; 
	        	// call to animate 
	        	var rotateCarousel = anime({ 
					targets: "#incubator-image",
					rotate: rotation + 'turn'
				});
	        }

	        function bmlcycle_count(num) {
	        	console.log("bmlcycle function called");
	        	cycleCount = num; 
	        }
	        //////////////////////////////////////////////////////////

	         // handler for SHOW response
	        function handle_SHOW_response(arg){
	                for(var propt in SHOW){
	                    var textBox;
	                    textBox = document.getElementById(propt);
	                    if( textBox === null){}
	                    else{
	                        textBox.value = eval('arg.' + propt);
	                    }
	                }
	            }
	            
	            function handle_RAW_SCAN_response(RAW_SCAN){
	                var dataPoints=[];
	                for (var i = 0; i < RAW_SCAN.length; i++) { 
	                    dataPoints.push({y:RAW_SCAN[i]});
	                } 
	                
	                var chrt = document.getElementById('chartContainer');
	                var chart = new CanvasJS.Chart(chrt, {

	                    theme: theme1,
	                    title:{
	                        text: "RAW SPECTRUM READING",
					        fontFamily: "Josefin Sans",
					        fontSize: 20             
	                    },
					    
					    axisX:{
					        title:"WAVELENGTH (nm)",
					        titleFontFamily: "Josefin Sans",
					        titleFontSize: 15,
					        minimum: 0,
					        maximum: 800,
	                        tickThickness: 1,
	                        tickLength: 5,
	                        gridThickness: 1,
	                        lineThickness: 1,
	                      },
					    
					    axisY:{
					        title: "RAW A/D COUNTS",
					        titleFontFamily: "Josefin Sans",
					        titleFontSize: 15,
					        minimum: 0,
					        maximum: 40000,
	                        tickThickness: 1,
	                        tickLength: 5,
	                        gridThickness: 1,
	                        lineThickness: 1
	                      },

	                    animationEnabled: true,
	                    
	                    data: [              
	                    {
	                        // Change type to "bar", "area", "spline", "pie",etc.
	                        type: "line",
	                        lineThickness: 1,
	                        dataPoints: dataPoints
	                    }
	                    ]
	                });
	                chart.render();


	                // TRY MAKING NEW TYPE OF CHART ////////////////////////////////////////
	                  var container = document.getElementById('hoihoihoi');

					  // var dataSet = new vis.DataSet(dataPoints); 
					  // var options = {
					 	//   start: '2014-06-10',
		    	// 		  end: '2014-06-18'
					  // }; 
					  // var graph2d = new vis.Graph2d(container, dataset, options)

					    // var container = document.getElementById('graph');
						  var items = [
						    {x: '2014-06-11', y: 10},
						    {x: '2014-06-12', y: 25},
						    {x: '2014-06-13', y: 30},
						    {x: '2014-06-14', y: 10},
						    {x: '2014-06-15', y: 15},
						    {x: '2014-06-16', y: 30}
						  ];

						  var dataset = new vis.DataSet(items);
						  var options = {
						    start: '2014-06-10',
						    end: '2014-06-18'
						  };
						  var graph2d = new vis.Graph2d(container, dataset, options)

					  //////////////////////////////////////////////////////////////////////

	            }       
	                     
	            
	            // setCalibrationData() is used to push new calibration data into the MCU controlling the spec
	       function specLightOnFunction(){

	            topicName = '@spec';
	            msgToWeb = 'Spec <b> White </b> Light is ' + '<b>'+ 'on' + '</b>' ;
	            msgToMachine = specPrefix +  ':' +  'WHITE 1' + ';' ;

	            sendInterfaceMessage( msgToWeb, msgToMachine  );
	            sendMachineMessage( msgToMachine  );

	       }

	       function specUVOnFunction(){

	            topicName = '@spec';
	            msgToWeb = 'Spec <b> UV </b> Light is ' + '<b>'+ 'on' + '</b>' ;

	            msgToMachine = specPrefix +  ':' +  'UVLASER 1' + ';' ;

	            sendInterfaceMessage( msgToWeb, msgToMachine  );
	            sendMachineMessage( msgToMachine  );

	       }

	       function specUVOffFunction(){

	            topicName = '@spec';
	            msgToWeb = 'Spec <b> UV </b> Light is ' + '<b>'+ 'off' + '</b>' ;

	            msgToMachine = specPrefix +  ':' +  'UVLASER 0' + ';' ;

	            sendInterfaceMessage( msgToWeb, msgToMachine  );
	            sendMachineMessage( msgToMachine  );

	       }


	       function specShowFunction(){
	            topicName = '@spec';
	            msgToMachine = specPrefix +  ':' +  'SHOW' + ';' ;
	            sendMachineMessage( msgToMachine  );

	       }

	       function specStartFunction(){
	            topicName = '@spec';
	            msgToMachine = specPrefix +  ':' +  'START' + ';' ;
	            sendMachineMessage( msgToMachine  );

	       }

	       function specStopFunction(){
	            topicName = '@spec';
	            msgToMachine = specPrefix +  ':' +  'STOP' + ';' ;
	            sendMachineMessage( msgToMachine  );

	       }

	       function specRawSpectrumFunction(){

	            topicName = '@spec';
	            timeStamp = getFormattedDate();

	            msgToWeb = '<b> Spectrometer reading @ </b>'  + timeStamp ;

	            msgToMachine = specPrefix +  ':' +  'RAW_' + ';' ;

	            sendInterfaceMessage( msgToWeb, ''  );
	            sendMachineMessage( msgToMachine  );

	       }

	       function specLightOffFunction(){

	            topicName = '@spec';

	            msgToWeb = 'Spec <b> White </b> Light is ' + '<b>'+ 'off' + '</b>' ;

	            msgToMachine = specPrefix +  ':' +  'WHITE 0' + ';' ;

	            sendInterfaceMessage( msgToWeb, msgToMachine  );
	            sendMachineMessage( msgToMachine  );

	       }

	       function setSpecCalibrationButtonFunction(){
	            
	            topicName = '@spec';
	            
	            var message = ":CALIBRATE";
	            message += " " + document.getElementById('serial').value;
	            message += " " + document.getElementById('A0').value;
	            message += " " + document.getElementById('B1').value;           
	            message += " " + document.getElementById('B2').value;
	            message += " " + document.getElementById('B3').value;
	            message += " " + document.getElementById('B4').value;
	            message += " " + document.getElementById('B5').value;
	            message +=";"
	            
	            sendMachineMessage(message);
	            }

	            // setClockRate() is used to set a new clock rate
	        
	        function setClockPeriodButtonFunction(){
	            
	            topicName = '@spec';

	            var message = ":CLOCK_PERIOD";
	            message += " " + document.getElementById('clockPeriod').value + ';';
	            sendMachineMessage(message);
	            }
	            
	        function sendMachineMessage(m) {
	                if (ws.readyState == 1) { ws.send(m); }
	            }


	        /*Functions added for GUI */
	         
	        function sendInterfaceMessage(m1, m2){

	            document.getElementById("status").innerHTML =  "<span style=\"color:#355ea3\">" + m1 + "</span>" + '&nbsp &nbsp &nbsp &nbsp'+ "<span style=\"color:black\">" + m2 + "</span>"; ; 

	        }

	        function electroporatorLidButtonFunction(){

	            action = $("#electroporatorLidPosition").children(":selected").attr("value");
	            

	            //OPEN or CLOSE
	            
	            msgToWeb = 'Electroporator lid is ' + '<b>'+ action.toUpperCase() + '</b>' ;
	            msgToMachine = electroporatorPrefix +  ':' + action.toUpperCase() + ';' ;

	            sendMachineMessage( msgToMachine  );
	            sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	            
	        }
	   
	        function electroporateButtonFunction(){

	            setting = $("#transformationSetting").children(":selected").attr("value");
	            

	            //yeast vs. ecoli

	            if (setting=='yeast'){
	                
	                msgToWeb = 'Transformation is prepared for ' + '<b>'+ setting.toUpperCase() + '</b>' ;
	                msgToMachine = electroporatorPrefix +  ':' + 'FIRE' + ';';
	            }
	            else if (setting=='ecoli'){
	                
	                msgToWeb = 'Transformation is prepared for ' + '<b>'+ setting.toUpperCase() + '</b>' ;
	                msgToMachine = electroporatorPrefix +  ':' + 'FIRE' + ';';             
	            }
	            

	            //sendMachineMessage( msgToMachine  );
	            sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	        }

	        function carouselButtonFunction(){

	                carouselNo = $("#carouselNo").children(":selected").attr("value");
	                carouselStation = $("#carouselStation").children(":selected").attr("value");

	                var carouselNoInt = parseInt(carouselNo) - 1 ;
	                
	                msgToWeb = 'Carousel: '+ '<b>' + carouselNoInt.toString() + '</b>' + ' moving to ' + '<b>'+carouselStation+'</b>' ;
	                
	                if (carouselStation != '4')
	                    msgToMachine = carouselPrefix +  ':' + 'MOVE ' + carouselNoInt.toString() + ' ' +carouselStation +';' ;       
	                else
	                    msgToMachine = carouselPrefix +  ':' + 'HOME;' ;

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;

	        }

	        function pumpButtonFunction(){
	                
	                pumpDuration = $("#pumpDuration").children(":selected").attr("value");

	                msgToWeb = 'Pump active for '+ '<b>' + pumpDuration + '</b>'+ ' milisecs.' ;
	                msgToMachine = pumpPrefix +  ':' + 'PUMP ' + pumpDuration +';' ;       

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	        }


	        function wheelPosButtonFunction(){
	                
	                
	                wheelPosFree = document.getElementById('wheelPosFree').value;

	                //check if input box has an input
	                if (wheelPosFree.length > 0){
	                wheelPos =  wheelPosFree;
	                } 
	                //else look at the value from dropdown
	                else{
	                 wheelPos = $("#wheelPosition").children(":selected").attr("value");
	                }

	                

	                //"@wheel:set incustepper 0;"
	                //msg = wheelprefix + ':set ' + 'incustepper' +  wheelNo;"
	                //sendMachineMessage("@wheel:set incustepper 0;");

	                msgToWeb = 'Incustepper to: '+ wheelPos ;
	                msgToMachine = wheelPrefix +  ':' + 'set incustepper ' + wheelPos +';' ;       

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	                
	         }

	        function wheelSpeedButtonFunction(){
	                
	                
	                wheelSpeed  = document.getElementById('wheelSpeed').value;
	                
	                //"@wheel:set incustepper 0;"
	                //msg = wheelprefix + ':set ' + 'incustepper' +  wheelNo;"
	                //sendMachineMessage("@wheel:set incustepper 0;");

	                msgToWeb = 'Incustepper speed: '+ wheelSpeed ;
	                msgToMachine = wheelPrefix +  ':' + 'set incuspeed ' + wheelSpeed +';' ;       

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	                
	         }


	        function syringeButtonFunction(){
	                

	                syringeNo = $("#syringeNo").children(":selected").attr("value");
	                syringeAmount = $("#syringeAmount").children(":selected").attr("value");
	                syringeAction = $("#syringeAction").children(":selected").attr("value");

	                //@i2cSerialProxy:SY_E 17;
	                if (syringeAction=='extend') 
	                	msgToMachine = syringeProxyPrefix + ':' + 'SY' + '_E ' + syringeNo +';' ;
	                else if (syringeAction=='retract')
						msgToMachine = syringeProxyPrefix + ':' + 'SY' + '_Z ' + syringeNo +';' ;

					msgToWeb = 'Syringe # ' + syringeNo + ' ' +syringeAction + ' ' + syringeAmount + ' ml.'
	                document.getElementById("status").innerHTML =   "<span style=\"color:#355ea3\">" + msgToWeb; + "</span>"; 

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	                
	                
	         }

	        function plungerButtonFunction(){
	                

	                syringeNo = $("#syringeNo").children(":selected").attr("value");
	                syringeAmount = $("#syringeAmount").children(":selected").attr("value");

	                //@i2cSerialProxy:PL_M 17 10;
	                msgToMachine = syringeProxyPrefix + ':' + 'PL_M' + ' ' +syringeNo + ' ' + syringeAmount + ';' ;


	                msgToWeb = 'Syringe # ' + syringeNo + ' ' + syringeAmount + ' dispensed'
	                document.getElementById("status").innerHTML =   "<span style=\"color:#355ea3\">" + msgToWeb; + "</span>"; 

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	                
	                
	         }


	        function mediaMagazineButtonFunction(){
	                

	                mediaMagazinePosition = $("#mediaType").children(":selected").attr("value");

	                //msgToMachine = purifierPrefix +  ':' + 'set magazine ' + mediaMagazinePosition + ';' ;  
	                msgToMachine = purifierPrefix +  ':' + 'SPIN ' + mediaMagazinePosition + ';' ;

	                msgToWeb = 'Media magazine is moving to ' + mediaMagazinePosition;
	                document.getElementById("status").innerHTML =   "<span style=\"color:#355ea3\">" + msgToWeb; + "</span>"; 

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	                
	         }

	        function centrifugeButtonFunction(){

	            speed = $("#centrifugeSpeed").children(":selected").attr("value");


	            msgToWeb = 'Centrifuge Speed is ' + speed;
	            document.getElementById("status").innerHTML =   "<span style=\"color:#355ea3\">" + msgToWeb; + "</span>"; 

	            //The new centrifuge code accepts :CENT <speed>;
	            //msgToMachine = purifierPrefix +  ':' + 'set centrifuge ' + speed + ';' ;
	            msgToMachine = purifierPrefix +  ':' + 'CENT ' + speed + ';' ;

	            sendMachineMessage(msgToMachine);
	            sendInterfaceMessage ( msgToWeb, msgToMachine ) ;

	        }
	          


	         function getIncuTempButtonFunction(){

	                topicName = '@incubator';

	                //msgToWeb = 'Incubator Temp is <b>' + currentTemp +  '</b>'; 
	                msgToMachine = tempPrefix +  ':' + 'get temp 0;' ;   

	                sendMachineMessage(msgToMachine);
	                //sendInterfaceMessage ( msgToWeb, msgToMachine ) ;

	                //sendMachineMessage("@heater:set heater 1;");
	         }  

	         function heaterButtonOnFunction(){

	                msgToWeb = 'Heater is <b>On</b>'; 
	                msgToMachine = heaterPrefix +  ':' + 'set heater 1;' ;   

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;

	                //sendMachineMessage("@heater:set heater 1;");
	         }  

	         function heaterButtonOffFunction(){

	                msgToWeb = 'Heater is <b>Off</b>'; 
	                msgToMachine = heaterPrefix +  ':' + 'set heater 0;' ;   

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage ( msgToWeb, msgToMachine ) ;
	         } 

	         function sendRawCommandFunction(){

	                msgToMachine = document.getElementById('rawCommandForDebug').value;
	                msgToWeb = 'Debug: ' + msgToMachine ;

	                sendMachineMessage(msgToMachine);
	                sendInterfaceMessage (msgToWeb, msgToMachine ) ;

	         } 

	         function getFormattedDate() {
	                var date = new Date();

	                var month = date.getMonth() + 1;
	                var day = date.getDate();
	                var hour = date.getHours();
	                var min = date.getMinutes();
	                var sec = date.getSeconds();

	                month = (month < 10 ? "0" : "") + month;
	                day = (day < 10 ? "0" : "") + day;
	                hour = (hour < 10 ? "0" : "") + hour;
	                min = (min < 10 ? "0" : "") + min;
	                sec = (sec < 10 ? "0" : "") + sec;

	                var str =  hour + ":" + min + ":" + sec + "   " + date.getFullYear() + "-" + month + "-" + day ;
	                //var str = day + "_" +  hour + ":" + min + ":" + sec;

	                /*alert(str);*/

	                return str;
				}
 		</script>

		<script type="text/javascript">
		  var wavelengths = null;
		  var chart; 

		  // Create a client instance
		  // client = new Paho.MQTT.Client("m12.cloudmqtt.com", 35984, "web_" + parseInt(Math.random() * 100, 10));
		  client = new Paho.MQTT.Client("m11.cloudmqtt.com", 36025, "web_" + parseInt(Math.random() * 100, 10));

		  // set callback handlers
		  client.onConnectionLost = onConnectionLost;
		  client.onMessageArrived = onMessageArrived;
		  var options = {
		    useSSL: true,
		    userName: "gdowfqda",
		    password: "GleM9oIvIuao",
		    onSuccess:onConnect,
		    onFailure: doFail
		  }

		  // connect the client
		  client.connect(options);

		  // called when the client connects
		  function onConnect() {
		    // Once a connection has been made, make a subscription and send a message.
		    console.log("Successful connection to CloudMQTT");
		    client.subscribe("directory/#"); // the messages that this client subscribes to
		    message = new Paho.MQTT.Message("Biolab Page Loaded");
		    message.destinationName = "directory/initialize";
		    client.send(message); 
		  }

		  function doFail(e){
		  	console.log("Failed to connect to CloudMQTT")
		    console.log(e);
		  }

		  // called when the client loses its connection
		  function onConnectionLost(responseObject) {
		    if (responseObject.errorCode !== 0) {
		      console.log("onConnectionLost:"+responseObject.errorMessage);
		    }
		  }

		  // called when a message arrives
		  function onMessageArrived(message) {
		    console.log("onMessageArrived:"+ message.payloadString);

		    // parsing message received from CloudMQTT 
		    var data = message.payloadString; 
		    data = data.substr(1); 

	        if (data.includes("carouselProcessing")) {
		        data = data.replace(": ", "_");
		        data = data.replace(" ", "(");
		        data = data.replace("\r", ") //"); // CHANGE BACK TO: ("\r", ") //")
		        eval(data); // dangerous but effective 
	        } else if (data.includes("bmlcycle")) {
	            data = data.replace("=", "(");
	            data += ")";
				eval(data); 
	        } else if (data.includes("WAVELENGTHS")) {
	        	data = data.substr(6); 
	        	data = data.replace("=","(");
	        	data += ")";
	        	eval(data); // calls WAVELENGTHS(arg)   
				// cut out everything up to the NM
	        } else if (data.includes("RAW_SCAN")) {
	        	data = data.substr(6);
	        	data = data.replace("=","("); 
	            data = data + ")"; 
				eval(data); 
	        }
		  }

		  // handler for WAVELENGTHS response
		  function WAVELENGTHS(arg) {
		  	wavelengths = arg.NM; // get NM member from response
		  }

		  // handler for RAW_SCAN response
		  function RAW_SCAN(arg) {
		  	var dataPoints = []; 
		  	for (var i = 0 ; i < arg.length; i++) {
		  		if (wavelengths === null) {
		  			dataPoints.push({y:arg[i]});
		  		}
		  		else {
		  			dataPoints.push({y:arg[i], x:wavelengths[i]});
		  		}
		  	}

		  	// set x axis title
		  	// if wavelengths unknown, label will be "bin number"
		  	// else label will be wavelength (nm) 
		  	var xAxisTitle = (wavelengths === null) ? "bin number" : "Wavelength (nm)";
				
				chart = new CanvasJS.Chart("chartContainer", {
					theme: "theme1",
					title:{
						text: "RAW SPECTRUM READING",
						fontFamily: "Josefin Sans",
      					fontSize: 20               
					},
					animationEnabled: true,   // change to true
					axisX:{
						title: xAxisTitle
					},
					axisY:{
						title: "Raw A/D Counts"
					},
					data: [              
					{
						// Change type to "bar", "area", "spline", "pie",etc.
						type: "line",
						dataPoints: dataPoints
					}
					]
				});
				chart.render();
		  }

		</script>

		<title> biomakerlab </title>
   		<meta charset="utf-8"> 
  	    <meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="src/main-style.css">
 		<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script> 
		<script type="text/javascript" src="anime.min.js"></script>

		<script type="text/javascript" src="html2canvas.js"></script>

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<!-- commenting --> 
		<link rel="stylesheet" type="text/css" href="Viima-jquery-comments-797ebae/css/jquery-comments.css">
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script type="text/javascript" src="Viima-jquery-comments-797ebae/js/jquery-comments.js"></script>
		<!-- google fonts --> 
		<link href="https://fonts.googleapis.com/css?family=Josefin+Slab" rel="stylesheet" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet" type="text/css">

	</head>

	<body id="myPage" data-spy="scroll" data-target=".navbar" 
	>
	  <div class="jumbotron text-center" style="background-color: #f9f9f9; margin-bottom:0;">

	    <h1 style="font-family: Josefin Slab; letter-spacing: 3px"><br><br><strong>bio.maker.lab</strong></h1> 
	    <br>
	    <p style="font-family: Josefin Sans; text-transform: lowercase; font-size: 16px; text-align: center">  
	    	  <strong> CHOOSE A CELL TYPE: </strong> <br>

	    	  <label class="project-button" onclick="drawInc(1), displayInfo(1)"> 
	    	  	<input type="radio" name="project" value="logo"> biologo <br> 
	    	  </label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

	    	  <label class="project-button" onclick="drawInc(2), displayInfo(2)"> 
	    	  	<input type="radio" name="project" value="design"> biosensor <br> 
	    	  </label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

	    	  <label class="project-button" onclick="drawInc(3), displayInfo(3)"> 
	    	  	<input type="radio" name="project" value="logo"> biocakes <br> 
	    	  </label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</p>  

		<div class="row text-center" id="project-info" style="border:0px solid black; width:30%; margin-left:35%">
			<p style="font-family: Josefin Sans; text-transform: lowercase; font-size: 15px; text-align: center">
			<br><br><br><br><br><br><br><br>
			</p>
		</div>
		<div id="first-button"> 
 	    	<a class="begin-button" href="#step1"> Begin <br>
	    		<span class="glyphicon glyphicon-chevron-down"> </span> </a> <p></br></p>
	    </div>
	  </div> 

	  <!-- navigation bar --> 
		<nav class="navbar navbar-default navbar-fixed-top" style="background-color: #f9f9f9; border: 1; border-color: black;">
		  <div class="container">
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span> 
		      </button>
		      <a class="navbar-brand" href="#myPage" style="font-family: Josefin Slab">bio.maker.lab</a>
		    </div>
		    <div class="collapse navbar-collapse" id="myNavbar">
		      <ul class="nav navbar-nav navbar-right">
		        <li><a href="#step1">Transform</a></li>
		        <li><a href="#step2">Incubate</a></li>
		        <li><a href="#step3">Analyze</a></li>
		        <li><a href="#step4">Record</a></li>
		      </ul>
		    </div>
		  </div>
		</nav>

		<div class="container-fluid" style="background-color:#e8efe8"  id="step1">
			<div class="row text-center"> 
				<h4> <br><br><br>  - step 1 -</h4> 
				<h2> <strong> TRANSFORM </strong> </h2>  

				<div id="transform-info"> 
					<p style="font-size: 15px; text-transform:none; width: 60%; margin-left:20%"> 
						In this section, we will explore the process of bacterial transformation. <br>
						Follow along as we go through the steps of how bacteria is transformed. <br><br>
					</p>
				</div>

				<div class="col-sm-4" style="border:0px solid black; padding:0px 30px 0px 30px"> 
					<h3> 1. Place </h3> 
					First, the cuvette must be placed into a cooler to stabilize the solution. Enter a low temperature for a long amount of time.  <br>
					<canvas id="cuv-anim-1" style="border:0px solid black; width:250px;" width="500" height="400">  </canvas>  <br>
					<form id="temp1" style="font-size:13px">
					  <br> Enter Temperature: <input type="text" name="fname" value="25"> °C
					</form> <p></p>
					<form id="frm1" style="font-size:13px">
					  Enter Countdown: <input type="text" name="fname" value="3:00">&nbsp;&nbsp;
					</form> <p></p>
					<button class="begin-anim-button" onclick="userSetTime1(), startCuv1(), cuvStep1(), userSetTemp(1)"> PLACE CUVETTE <div id="cuv-timer-1" class="countdown" style="font-size:20px"> - </div></button> <br><br>

					<button id="trig-sub1" class="reveal-button" onclick="slide('transform-sub1', 'trig-sub1', 1)">
						( see graphic )
					</button> <br>

					<div id="transform-sub1"> 
						This cooling process prepares the bacteria for gene uptake by changing membrane fluidity. <br>

						<canvas id="step-1-anime" style="border:0px solid black; width:250px;" width="400" height="210"> </canvas> <br>
						<button class="begin-anim-button" onclick="startBacAnim1()"> view process </button> 
					</div>
					<br><br><br>
				</div>

				<div class="col-sm-4" style="border:0px solid black; padding:0px 30px 0px 30px"> 
					<h3 style="text-transform:none;"> 2. Transform </h3> 
					Next, it is time for heat shock by creating a high temperature environment. Select the proper settings for this short burst of heat.  <br>

					<canvas id="cuv-anim-2" style="border:0px solid black; width:250px;" width="500" height="400">  </canvas>

					<form id="temp2" style="font-size:13px">
					  <br> Enter Temperature: <input type="text" name="fname" value=""> °C
					</form> <p></p>
					<form id="frm2" style="font-size:13px">
					  Enter Countdown: <input type="text" name="fname" value="">&nbsp;&nbsp;
					</form> <p></p>

						<button class="begin-anim-button" onclick="userSetTime2(), startCuv2(), cuvStep2(), userSetTemp(2)"> 
					BEGIN transform <br>
					<div id="cuv-timer-2" class="countdown" style="font-size:20px"> - </div>
					</button> <br>
					<br>

					<button id="trig-sub2" class="reveal-button" onclick="slide('transform-sub2', 'trig-sub2', 2)">
						( see graphic )
					</button> <br>

					<div id="transform-sub2"> 
						The rapid change in temperature creates pores in the membrane, allowing the plasmids to enter. <br>
						<canvas id="step-2-anime" style="border:0px solid black; width:250px;" width="400" height="210"> </canvas> <br>
						<button class="begin-anim-button" onclick="startBacAnim2()"> view process </button>
					</div>
					<br><br><br>
				</div>
				<div class="col-sm-4" style="border:0px solid black; padding:0px 30px 0px 30px"> 
					<h3> 3. Remove </h3>
					Finally, it is time to move the transformed solution to be incubated. This creates ideal conditions for cell multiplication. <br>

					<canvas id="cuv-anim-3" style="border:0px solid black; width:250px;" width="500" height="400">  </canvas>
					<br><br><br><br>

					<br> <button class="begin-anim-button" onclick="startCuv3()"> 
					REMOVE CUVETTE
					<div style="font-size:21px; color: #E4AF9A"> - </div> </button>
					<br><br>

					<button id="trig-sub3" class="reveal-button" onclick="slide('transform-sub3', 'trig-sub3', 3)">
						( see graphic )
					</button> <br>

					<div id="transform-sub3">
						Now the cell membrane can comfortably self-heal with the plasmid inside. <br>
						<canvas id="step-3-anime" style="border:0px solid black; width:250px;" width="400" height="210"> </canvas> <br>
						<button class="begin-anim-button" onclick="startBacAnim3()"> view process </button>
					</div> 
				</div> 
		    </div>
			<div class="row text-center" style="border:0px solid black;">
				<a class="begin-button" href="#step2"> Next <br>
	    		<span class="glyphicon glyphicon-chevron-down"> </span> </a> <p></br><br></p>
	    	</div>
		</div>


		<div class="container-fluid" style="background-color:#dbe0db" id="step2">
			<h4 class="row text-center"> <br><br><br>- step 2 -</h4> 
			<h2 class="row text-center"> <strong>INCUBATE</strong> </h2> 

			<div class="row text-center" id="incubate-info" style="font-size: 15px; width: 60%; margin-left:20%">
		    	<p style="text-transform:none;"> Once the bacteria has been transformed, it is time to incubate. The Bio.Maker.Lab machine runs this process, and this page controls the machine. Once the machine starts, the digital incubator below follows the rotation of the actual machine. Additionally, there are real time readings of temperature, time and optical density. <br><br> </p>
		    </div>

			<div style="border:0px solid black; width:120px; height:20px; margin-left:20%"> 
				<object style="border:0px solid black; float:left" height="50" data="graphics/therm.png"></object>
				<div style="border:0px solid black; float:right; font-size:18px" id="display-temp" class="rectangle"> </div>
			</div>

			<div class="row text-center" style="border:0px solid black;"> 
				<canvas id="incubator-image" style="border:0px solid black; width:40%; margin-right:25%" width="1000" height="1000"> </canvas>
			</div>

			<!-- <div style="margin-left:20%"> TIME: </div>
			<div style="margin-left:20%;" id="incubate-timer"> 00:00 </div> -->

			<!-- buttons -->
			<div class="row text-center" > 
				<!-- <br> <button class="to-top" onclick="redrawSyringe()"> (test color change) </button> <br><br> -->
				<button class="button" onclick="beginButton(), startTime(), disRealTimeOD(1), disRealTimeOD(2), disRealTimeOD(3), disRealTimeOD(4), disTemp()" class="start"> Begin Machine </button> &nbsp;
				<button class="button" onclick="stopButton()" class="stop"> Stop Machine </button> 
				<br><br><br><br><br>
			</div> 

			<!-- OD TIMING VIS --> 
			<div class="row text-center" style="">
				<div id="realTimeOD" style="font-size:17px;"> <strong> OPTICAL DENSITY (OD) READINGS: </strong> <br><br></div> 
				<div class="col-sm-4"></div>
				    <div class="col-sm-1">
			      <div class="thumbnail-holder">
			        <div id="od-1" class="circle" style="background-color:#98A1AD;"><br><br> </div> <p> <br> Syringe 1 </p>
			      </div>
			    </div>
			    <div class="col-sm-1">
			      <div class="thumbnail-holder">
			        <div id="od-2" class="circle" style="background-color:#6c8b98"><br><br> </div>	<p> <br> Syringe 2 </p>
			      </div>
			    </div>
			    <div class="col-sm-1">
			      <div class="thumbnail-holder">
			        <div id="od-3" class="circle" style="background-color:#E4AF9A;"><br><br> </div> <p> <br> Syringe 3 </p>
			      </div>
			    </div>
			    <div class="col-sm-1">
			      <div class="thumbnail-holder">
			        <div id="od-4" class="circle" style="background-color:#AD9A98;"><br><br> </div> <p> <br> Syringe 4 </p>
			      </div>
			    </div>
			    <div class="col-sm-4"></div>
				<p><br><br><br><br><br><br><br><br><br><br></p>
				<a class="begin-button" href="#step3"> Next <br>
	    		<span class="glyphicon glyphicon-chevron-down"> </span> </a> <p></br><br></p>
    		</div>
		</div>

		<div class="container-fluid bg-grey" style="background-color:#dee3ed" id="step3">
			<h4 class="row text-center"> <br><br><br>- step 3 -</h4> 
			<h2 class="row text-center"><strong> DATA ANALYSIS</strong> </h2>	
			<div class="row text-center" id="data-info" style="font-size: 15px; width: 60%; margin-left:20%">
		    	<p style="text-transform: none;"> Now that the machine has started running, it is time to analyze the data. Below, each syringe being incubated has a graph of its optical density history. Additionally, the raw spectrum reading can be viewed. <br><br> </p>
			</div>
			<div id="od-history-graphs" class="row text-center"> 
			  	<div style="width: 70%; margin-left: 15%" id="vis-1"></div> 
			  	<div style="width: 70%; margin-left: 15%" id="vis-2"></div> 
			  	<div style="width: 70%; margin-left: 15%" id="vis-3"></div> 
			  	<div style="width: 70%; margin-left: 15%" id="vis-4"></div> 
				<p> <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br> </p>
			    <p> <button class="to-top" id="updateDataOD" style="font-size:15px; outline-width:1px; outline-color:black; outline-style: solid; padding:3px 10px 0px 10px; "> click to update reading  </button> <br><br></p>
			    <div class="col-sm-2"></div>
				    <div class="col-sm-2">
			      <div class="thumbnail-holder">
			      	<button class="begin-button" style="background-color:#98A1AD; color: black; outline-width:1px; padding: 11px 20px 9px;" onclick="chooseGraph(1)"> Display Syringe 1 </button>
					<br><br> <div id="vis-1a"></div>
			      </div>
			    </div>
			    <div class="col-sm-2">
			      <div class="thumbnail-holder">
			      	<button class="begin-button" style="background-color:#6c8b98; color: black; outline-width:1px; padding: 11px 20px 9px;" onclick="chooseGraph(2)"> Display Syringe 2 </button>
			        <br><br> <div id="vis-2a"></div>
			      </div>
			    </div>
			    <div class="col-sm-2">
			      <div class="thumbnail-holder">
			      	<button class="begin-button" style="background-color:#E4AF9A; color: black; outline-width:1px; padding: 11px 20px 9px;" onclick="chooseGraph(3)"> Display Syringe 3 </button>
			        <br><br> <div id="vis-3a"></div>
			      </div>
			    </div>
			    <div class="col-sm-2">
			      <div class="thumbnail-holder">
			      	<button class="begin-button" style="background-color:#AD9A98; color: black; outline-width:1px; padding: 11px 20px 9px;" onclick="chooseGraph(4)"> Display Syringe 4 </button>
			        <br><br> <div id="vis-4a"></div>
			      </div>
			    </div>
			    <div class="col-sm-2"></div>
				<p> <br><br><br><br> </p>

			<div class="row text-center">
				<button class="to-top" id="save_image_locally"> ( Download Graph ) </button>
			</div>
				<!-- Trigger the modal with a button -->
				<div style="font-size: 14px;font-family:Josefin Sans;padding-bottom:10px"> <br>CLICK FOR RAW SPECTRUM RESULTS: </div>  
			  <button type="button" class="button" data-toggle="modal" data-target="#myModal">  
			  	  Raw <br> Spectrum <br> Reading <br> </button>
			</div>


			<div class="container">
			  <!-- Modal -->
			  <div class="modal fade" id="myModal" role="dialog">
			    <div class="modal-dialog" style="width: 90%;">
			    
			      <!-- Modal content-->
			      <div class="modal-content">
			        <div class="modal-header">
			          <button type="button" class="close" data-dismiss="modal">&times;</button>
			        </div>
			        <div class="modal-body">
			         	<div id="chartContainer" style="height: 300px; width: 70%; margin-left: 15%;" class="row text-center"> </div>  
			         	<br><br><br><br><br><br><br>
			     	</div>
			        <div class="modal-footer">
			          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        </div>
			      </div>
			    </div>
			  </div>
			</div>
			<p><br><br><br>
		</div>
		<!--  temporarily removing "comments" section 
		<div class="container-fluid bg-grey" style="outline: 2px solid black; background-color:#f3e1d9" id="step4">
			<h4 class="row text-center"> <br><br><br>- feedback or questions? -</h4> 
			<h2 class="row text-center"><strong> LEAVE A COMMENT </strong> </h2> <br><br>
				<div id="disqus_thread"></div>
		</div> -->
		<div class="container-fluid bg-grey" style="outline: 2px solid black; background-color:#f3e1d9" id="step4">
			<h4 class="row text-center"> <br><br><br>- notes - </h4> 
			<h2 class="row text-center"><strong> RECORD </strong> </h2> 
			<div class="row text-center" id="notes-info" style="font-size: 15px; width: 60%; margin-left:20%">
		    	<p style="text-transform: none;">Fill out and download this form to remember your project details! </p> 
		    </div>
 				<div class="row text-center"> 
				    <form id="user-data"> <br>
					    Name: &nbsp;<input type="text" name="fullName" id="fullNameId" class="notes" value=""><br>
					    Date: &nbsp;&nbsp;&nbsp;<input type="text" name="date" id="dateId"  class="notes" value=""><br>
					    Project: <input type="text" class="notes" name="projName" id="projNameId" value=""><br><br>
					    Notes about the project: <br> <textarea style="width:350px" rows=8 cols=150 class="notes" name="textMain" id="textMainId"></textarea> <br>
					    Questions I still have: <br> <textarea style="width:350px"  rows=4 cols=100 class="notes" name="question" id="questionsId"></textarea> <br>
					    File Name (must end in .txt): <br> <input type="text" class="notes" name="fileName" id="fileNameId" value="biologo.txt"> <br>
				    </form> <br>
				  <button class="button" onclick="compileNotes()"> Download Notes </button><br><br>
 				</div>

			<div class="row text-center"> 
				<br><br><br><a class="to-top" href="#myPage"> ( back to top ) </a><p></br></p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="src/main.js"></script>
</html>